---
title: "Project 1 Final report"
author: Shuai Zhu
date: "`r Sys.Date()`"
output: 
  pdf_document:
    latex_engine: pdflatex
    keep_tex: true
    number_sections: true
    fig_caption: true
fontsize: 12pt
geometry: "margin=1in"
header-includes:
   - \usepackage{setspace}
   - \onehalfspacing
   #- \doublespacing
---
<style>
  body {
    font-family: Arial, sans-serif;
  }
</style>
```{r,echo = F, message=F}
library(table1)
library(tidyverse)
library(kableExtra)
working_directory <- 'C:/Users/zhu-s/OneDrive/Graduate File/Course/Bios6624/BIOS6624-shuai/Project1'
```

# Introduction

The data used in this analysis come from the ongoing Multicenter AIDS Cohort Study (MACS), a prospective cohort study designed to understand the natural and treated histories of HIV-1 infection in homosexual and bisexual men across four major cities in the United States. This dataset includes eight years of longitudinal data from 715 HIV-infected men, capturing laboratory measurements, quality of life scores, demographic information, and other health-related data collected after the initiation of highly active antiretroviral therapy (HAART), which is the standard treatment for patients with HIV.

The primary research question is to examine how treatment response, two years after initiating HAART, differs between individuals who reported hard drug use at baseline and those who did not. Four key measures of treatment response are considered: viral load, CD4+ T cell counts, and physical and mental quality of life scores.

# Methods

## Data cleaning
Baseline and two year measurement was filtered for further analysis since the purpose of this project is find out how treatment response differ two years after treatment. The data with BMI greater than 200 or less than 0 was removed since it is impossible. The records with complete case was used for further analysis and the number of observations was reduced to 425. Furthermore, BMI was categorized to four levels underweight (BMI < 18.5 kg/m2), healthy (BMI 18.5 - 24.9 kg/m2), overweight(BMI 24.9 - 30 kg/m2) and obese (BMI > 30 kg/m2). Adherence was dichotomized into >=95% and <95%. The education levels was collapsed into three levels (High school or before, Some college, and Graduate or Post-graduate).  

## Data analysis

Both frequentist and Bayesian approaches were employed to assess differences in treatment response by baseline hard drug use. The four key outcomes used to assess treatment response were viral load, CD4+ T cell counts, and physical and mental quality of life scores (AGG_PHYS and AGG_MENT). The objective was to model the impact of hard drug use, adjusting for several covariates, including baseline treatment response, BMI, age, education level, and adherence. Viral load, due to its skewed distribution, was log-transformed to meet the assumption of normality. For the frequentist approach, four multivariable linear regression models were fitted, each predicting one of the treatment response outcomes. The model assumptions—independence, linearity, homoscedasticity, and normality—were carefully evaluated using standard diagnostic tools. Independence was verified by inspecting the structure of the data and residuals. Linearity was checked by assessing the relationship between predictors and outcome variables using residual plots. Homoscedasticity was evaluated using residuals vs. fitted values plots. Normality of residuals was tested through QQ-plots.

For Bayesian regression models, both non-informative and vague priors were used. The non-informative priors of beta are distributed with mean 0 and standard deviation 10^7. The vague priors of beta are distributed with mean 0 and standard deviation 10^6. The prior distribution for the model error was set as a half-Cauchy distribution with a scale parameter of 2.5. Bayesian inference was carried out using Markov Chain Monte Carlo (MCMC) sampling. Each model was run with 4 MCMC chains, with each chain consisting of 2,000 iterations, including a 1,000 iteration burn-in period to ensure convergence. The posterior distributions for all model parameters were summarized, and credible intervals were used to quantify uncertainty in the estimates.

For the frequentist models, standard metrics such as p-values and confidence intervals were used to assess the significance and effect sizes of the predictors. For the Bayesian models, the convergence of MCMC chains was assessed through trace plots. Posterior means and 95% credible intervals were reported for each parameter to provide a full picture of the uncertainty around the estimates.

R version 4.4.4 was used for all models.

# Result
The percentage of missing data was visualized in figure one. It is easily to see that four outcome measurement of treament response at year 2 and education level had about 30% missing. Viral load and CD4+ T Cell Count at baseline and BMI level had missing range from 3.4% to 5.9%. Physical quality of life and mental quality of life at Baseline, age and adherence had almost no missing. 425 participants was kept after removing subject with any missing value. Only 58% subjects was used for analysis. Among those subjects with complete cases, 35(8.2%) participants reported those as hard drugs user. This was shown in tableone.

## Frequentist

After adjusting for baseline log viral load, age, BMI, education levels, and adherence, the frequentist multivariable linear regression model suggests that patients who identified as hard drug users at baseline had 0.96 times the viral load compared to those who did not identify as hard drug users at baseline (95% CI: (0.39, 2.39), p value = 0.9367). This indicates that, on average, hard drug users had a slightly lower viral load compared to non-drug users.

After adjusting for baseline CD4+ T cell counts, age, BMI, education levels, and adherence, the frequentist multivariable linear regression model suggests that patients who identified as hard drug users at baseline had 186.284 lower CD4+ T cell counts compared to those who did not identify as hard drug users at baseline with the confidence interval suggesting that the true difference could range from a reduction of 124 to 249 CD4+ T cell(p value < 0.05). 

After adjusting for baseline CD4+ T cell counts, age, BMI, education levels, and adherence, the frequentist multivariable linear regression model suggests that patients who identified as hard drug users at baseline had 186.284 lower CD4+ T cell counts compared to those who did not identify as hard drug users at baseline with the confidence interval suggesting that the true difference could range from a reduction of 124 to 249 CD4+ T cell(p value < 0.05). 

After adjusting for baseline physical quality of life score, age, BMI, education levels, and adherence, the frequentist multivariable linear regression model suggests that patients who identified as hard drug users at baseline had an average 3.32-point lower physical quality of life score compared to non-drug users (95% CI: -6.02, -0.62). The confidence interval indicates that the true difference in physical quality of life score could range from a reduction of 6.02 to 0.62 points, and since the p-value is less than 0.05, this result is statistically significant, indicating a meaningful negative association between hard drug use and physical quality of life.

After adjusting for baseline physical quality of life score, age, BMI, education levels, and adherence, the frequentist multivariable linear regression model suggests that patients who identified as hard drug users at baseline had an average 1.17-point lower physical quality of life score compared to non-drug users (95% CI: -4.60, -2.25). The confidence interval indicates that the true difference in physical quality of life score could range from a reduction of 4.60 to 2.25 points, and since the p-value is less than 0.05, this result is statistically significant. This suggests a meaningful negative association between hard drug use and physical quality of life. 

## Bayesian




# Conclusion
```{r, echo = F,fig.cap = "Percentage of Missing Data by Variable"}
knitr::include_graphics(paste0(working_directory, '/DataProcessed/missing visulization.png'))
```



```{r, echo = F}
t1kable(readRDS(paste0(working_directory, '/Figure/Tableone.RDS')))%>%
  kable_styling(font_size = 10)
```


```{r, echo = F}
df_estimate <- readRDS(paste0(working_directory, '/DataProcessed/lm estimate.RDS'))
#df_estimate%>%knitr::kable(caption = 'Estimatae and 95% Confident interval of frequentist  approach')


df_noninfo_estimate <- readRDS(paste0(working_directory,'/DataProcessed/df_noninfo_estimate.RDS'))


df_vague_estimate <- readRDS(paste0(working_directory,'/DataProcessed/df_vague_estimate.RDS'))
#df_vague_estimate%>%knitr::kable(caption = 'Estimatae and 95% Credit interval of Bayesian approach with vague priors')

df_comparion <- cbind(df_estimate,df_vague_estimate)
rownames(df_comparion) <- c('Log Viral Load', 'CD4+ Count', 
                           "Physical score", "Mental score")
colnames(df_comparion)[c(1,4)] <- c('Frequentist', 'Vague' )

df_comparion%>%kable(digits = 3,caption = 'Comparions of estimate and 95% confident intervals and credit intervals between Frequentist and Bayesian approach')


rownames(df_noninfo_estimate) <- c('Log Viral Load', 'CD4+ Cell Count', 
                           "Physical score", "Mental score")
df_noninfo_estimate%>%knitr::kable(caption = 'Estimatae and 95% Credit interval of Bayesian approach with noninformative priors')
```

